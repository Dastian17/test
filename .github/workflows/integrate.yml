name: CI Workflow for Each Commit

on:
  push:
    branches:
      - '**'

jobs:
  run-for-each-commit:
    runs-on: ubuntu-latest
    steps:
      # Checkout the code
      - name: Checkout repository
        uses: actions/checkout@v3

      # Retrieve the list of commits for the push event
      - name: Get commits from push
        run: |
          echo "Commits in push:"
          echo "${{ toJson(github.event.commits) }}"
          
          # Iterate through each commit and run actions on each one
          for commit in $(jq -r '.[].id' <<< "${{ toJson(github.event.commits) }}"); do
            echo "Running actions for commit: $commit"
            git checkout $commit
            
            # Run your build and test for each commit
            echo "Running build for commit $commit"
            npm install
            npm run build
            npm run test-once
          done
        shell: bash

