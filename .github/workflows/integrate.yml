name: Ejecutar en cada push

on: push
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout del c√≥digo
      uses: actions/checkout@v2

    - name: Configurar Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '14'

    - name: Instalar dependencias
      run: npm install

    - name: Ejecutar pruebas y comentar cobertura
      env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # Configurar el token para GitHub CLI
      run: |
        for commit in $(git rev-list ${{ github.event.before }}..${{ github.sha }}); do
          echo "Procesando commit $commit"
          COVERAGE=$(npx jest --coverage)
          gh api repos/${{ github.repository }}/commits/$commit/comments -f body="### Jest Coverage Report for commit $commit: \n\n$COVERAGE"
        done

      